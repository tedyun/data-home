/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(b){b.gb=function(f,a){a=a||{};if(!(f instanceof b.ca))throw Error(b.T.fc._ERR_DATA_INVALID_TYPE_SUMMARY+"\n"+b.T.fc._ERR_DATA_INVALID_TYPE_DETAIL);this.i=f;this.hd=[];this.$=0;this.ho=[];null==this.i.Gy("fetchSize")&&(this.i.LN=function(){return-1});var d=this;this.i.rE=function(a,e,f){var h,k,l,m=[],n=[],p=[];for(e=0;e<f.R();e++)h=f.getData(e),l=f.getMetadata(e).key,k=a+e,d.ho[k]={},d.ho[k].nodeSet=f,d.ho[k].startIndex=a,m.push(h),
n.push(l),p.push(k),d.na.data.splice(k,0,h),d.na.keys.splice(k,0,l),d.na.indexes.splice(k,0,k);d.La||b.T.q.handleEvent.call(d,b.T.D.ADD,{data:m,keys:n,indexes:p});d.Ix();d.La&&setTimeout(function(){d.i.refresh();d.na=null;d.fetch()},0)};this.i.QE=function(a){var e,f,h=[],k=[],l=[];for(e=0;e<a.length;e++)f=a[e].index-e,h.push(""),k.push(""),l.push(f),d.na.data.splice(f,1),d.na.keys.splice(f,1),d.na.indexes.splice(f,1);d.La||b.T.q.handleEvent.call(d,b.T.D.REMOVE,{data:h,keys:k,indexes:l});d.Ix();d.La&&
setTimeout(function(){d.i.refresh();d.na=null;d.fetch()},0)};this.Init();if(null!=a&&("enabled"==a.startFetch||null==a.startFetch)||null==a)this.Zx=!0};o_("FlattenedTreeTableDataSource",b.gb,b);b.b.ga(b.gb,b.T,"oj.FlattenedTreeTableDataSource");b.gb.prototype.Init=function(){b.gb.q.Init.call(this)};b.b.g("FlattenedTreeTableDataSource.prototype.Init",{Init:b.gb.prototype.Init});b.gb.prototype.getCapability=function(){return"full"};b.b.g("FlattenedTreeTableDataSource.prototype.getCapability",{getCapability:b.gb.prototype.getCapability});
b.gb.prototype.getWrappedDataSource=function(){return this.i};b.b.g("FlattenedTreeTableDataSource.prototype.getWrappedDataSource",{getWrappedDataSource:b.gb.prototype.getWrappedDataSource});b.gb.prototype.fetch=function(b){b=b||{};return"init"!=b.fetchType||this.Zx?this.He(b):Promise.resolve()};b.b.g("FlattenedTreeTableDataSource.prototype.fetch",{fetch:b.gb.prototype.fetch});b.gb.prototype.at=function(b){var a;a=0>b||b>=this.na.length?null:{data:this.na.data[b],index:b,key:this.na.keys[b]};return new Promise(function(b){b(a)})};
b.b.g("FlattenedTreeTableDataSource.prototype.at",{at:b.gb.prototype.at});b.gb.prototype.collapse=function(b){this.i.collapse(b)};b.b.g("FlattenedTreeTableDataSource.prototype.collapse",{collapse:b.gb.prototype.collapse});b.gb.prototype.expand=function(b){this.i.expand(b)};b.b.g("FlattenedTreeTableDataSource.prototype.expand",{expand:b.gb.prototype.expand});b.gb.prototype.get=function(){b.l.Yb();return null};b.b.g("FlattenedTreeTableDataSource.prototype.get",{get:b.gb.prototype.get});b.gb.prototype.on=
function(f,a){if("expand"==f||"collapse"==f)this.i.on(f,a);else b.gb.q.on.call(this,f,a)};b.b.g("FlattenedTreeTableDataSource.prototype.on",{on:b.gb.prototype.on});b.gb.prototype.off=function(f,a){"expand"==f||"collapse"==f?this.i.off(f,a):b.gb.q.off.call(this,f,a)};b.b.g("FlattenedTreeTableDataSource.prototype.off",{off:b.gb.prototype.off});b.gb.prototype.sort=function(f){if(null==f)return Promise.resolve();var a=this;f.axis="column";return new Promise(function(d,c){a.i.getWrappedDataSource().sort(f,
{success:function(){setTimeout(function(){a.i.refresh();a.na=null;var c={header:f.key,direction:f.direction};b.T.q.handleEvent.call(a,b.T.D.SORT,c);d(c)},0)}.bind(this),error:function(a){c(a)}.bind(this)})})};b.b.g("FlattenedTreeTableDataSource.prototype.sort",{sort:b.gb.prototype.sort});b.gb.prototype.totalSize=function(){return-1};b.b.g("FlattenedTreeTableDataSource.prototype.totalSize",{totalSize:b.gb.prototype.totalSize});b.gb.prototype.totalSizeConfidence=function(){return"unknown"};b.b.g("FlattenedTreeTableDataSource.prototype.totalSizeConfidence",
{totalSizeConfidence:b.gb.prototype.totalSizeConfidence});b.gb.prototype.Nw=function(b){return this.ho[b].nodeSet.getMetadata(b-this.ho[b].startIndex)};b.gb.prototype.He=function(f){f=f||{};this.Yx(f);this.$=null==f.startIndex?this.$:f.startIndex;var a=Number.MAX_VALUE;this.La=null==f.pageSize?this.La:f.pageSize;null!=this.La&&(a=this.La);var d=this.$;if(null!=this.na)if(null!=this.La){var c=this.na.data.length-1;if(this.$+this.La-1<=c){var c=b.gb.JB(this.na,this.$,this.La),a=[],e=[],g;for(g=this.$;g<=
c;g++)a[g-this.$]=this.na.data[g],e[g-this.$]=this.Nw(g).key;c={data:a,keys:e,startIndex:this.$};this.jj(f,c,null);return Promise.resolve(c)}this.$<=c&&(d=c+1)}else this.i.refresh(),this.na=null;else d=0;var h={start:d,count:a},k=this;return new Promise(function(a,c){k.i.Jo(h,{success:function(c){k.UJ(c,d);f.refresh=!0;c=b.gb.JB(k.na,k.$,k.La);var e=[],g=[],h;for(h=k.$;h<=c;h++)e[h-k.$]=k.na.data[h],g[h-k.$]=k.Nw(h).key;c={data:e,keys:g,startIndex:k.$};k.jj(f,c,null);a(c)}.bind(this),error:function(a){k.jj(f,
null,a);c(a)}.bind(this)})})};b.gb.prototype.UJ=function(f,a){var d,c;for(d=0;d<f.R();d++)c=a+d,this.ho[c]={},this.ho[c].nodeSet=f,this.ho[c].startIndex=a;this.na||(this.na={},this.na.data=[],this.na.keys=[],this.na.indexes=[]);b.gb.tt(f,this,this.na)};b.gb.prototype.Yx=function(f){f.silent||b.T.q.handleEvent.call(this,b.T.D.REQUEST,{startIndex:f.startIndex})};b.gb.prototype.jj=function(f,a,d){null!=d?b.T.q.handleEvent.call(this,b.T.D.ERROR,d):f.silent||b.T.q.handleEvent.call(this,b.T.D.SYNC,a)};
b.gb.JB=function(b,a,d){var c=b.data.length-1;0<d&&(c=a+d-1,c=c>b.data.length-1?b.data.length-1:c);return c};b.gb.tt=function(b,a,d){a=b.R()-1;var c;for(c=b.ta();c<=a;c++){var e=b.getData(c);d.data[c]=e;d.keys[c]="";d.indexes[c]=c}};b.gb.prototype.Ix=function(){for(var b=0;b<this.na.data.length;b++)this.na.indexes[b]=b}});