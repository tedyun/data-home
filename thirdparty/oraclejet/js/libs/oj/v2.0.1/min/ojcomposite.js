/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","knockout","ojs/ojknockout"],function(b,f){function a(a,c){switch(c){case "view":return b.we.Gb.viewPath+a+b.we.Gb.viewSuffix;case "viewModel":return b.we.Gb.modelPath+a;case "metadata":return b.we.Gb.metadataPath+a+b.we.Gb.metadataSuffix;case "css":return b.we.Gb.cssPath+a}}function d(c,d){var e=null,f=c[d];if(null!=f){e=Object.keys(f)[0];f=f[e];if(null==e)throw"Invalid component descriptor key";switch(e){case "inline":e=Promise.resolve(f);break;case "promise":e=f;break;case "require":var g=
a(f,d),e=new Promise(function(a){require([g],function(b){a("metadata"===d?JSON.parse(b):b)},function(a){var c="ojComposite failed to load "+g;a&&"string"===typeof a&&(c=c+" due to: "+a);b.r.error(c);a instanceof Error&&b.r.error(a.stack)})});break;default:throw"Invalid descriptor key "+e+" for the resopurce type: "+d;}}return e}function c(a,c,d){if(null!=a&&(c=b.we.Gb[c],null!=c&&a&&(c=a[c],"function"===typeof c)))return f.ignoreDependencies(c,a,d)}function e(a,b,c,d){l(c,"properties",function(c,
e){h(a,b,c,e,d)})}function g(a,b,c){l(b,"methods",function(d){var e=b.methods[d].internalName;a[d]=e?c[e].bind(c):c[d].bind(c)})}function h(a,b,c,d,e){function g(b){var d=h.peek();d!==b&&(h(b),e.lpa()||(b=new CustomEvent(c+"-changed",{detail:{value:b,previousValue:d}}),a.dispatchEvent(b)))}var h=f.observable();k(b,c,function(){return h()},g);k(a,c,function(){return h.peek()},function(a){if(d.readOnly)throw"Read-only property "+c+" cannot be set";g(a)})}function k(a,b,c,d){Object.defineProperty(a,
b,{configurable:!0,enumerable:!0,get:c,set:d})}function l(a,b,c){if(a){var d=a[b]||{};Object.keys(d).forEach(function(a){c(a,d[a])})}}function m(a,b){["methods","properties"].forEach(function(c){l(b,c,function(b){delete a[b]})})}function n(a){var b={};a=a.childNodes;for(var c=0;c<a.length;c++){var d=a[c];if((1===d.nodeType||3===d.nodeType)&&(3!==d.nodeType||d.nodeValue.trim())){var e=d.__oj_slots;(e=null!=e?e:d.getAttribute&&d.getAttribute("slot"))||(e="");b[e]||(b[e]=[]);b[e].push(d)}}return b}function p(a,
b){var c,d=a.childNodes;if(d){c=document.createElement("div");c.setAttribute("data-bind","_ojNodeStorage_");c.style.display="none";b.push(c);for(var e=[],f=0;f<d.length;f++){var g=d[f];1!==g.nodeType&&3!==g.nodeType||e.push(g)}e.forEach(function(a){c.appendChild(a)})}return c}function r(a,c){function d(a,b,c){h(c,b,a)||a.readOnly||(a=e(c,a.type),m(b,a))}function e(a,b){switch(b.toLowerCase()){case "boolean":return Boolean(a);case "number":return Number(a);case "string":return a;default:return JSON.parse(a)}}
function g(a){return a.toLowerCase().replace(/-(.)/g,function(a,b){return b.toUpperCase()})}function h(d,e,g){d=b.Sr.Z2(d);delete J[e];var l=n[e];l&&(l.dispose(),delete n[e]);if(l=r[e])a.removeEventListener(e+Q,l),delete r[e];var x,l=g.readOnly;l||(x=function(){var a=p[e];a&&(a.dispose(),delete p[e])},x());var u=d.expr;if(u){var v=b.ia.uA(u);l||f.ignoreDependencies(function(){n[e]=f.computed(function(){x();if(!J[e]){var a=v(c);f.isObservable(a)?p[e]=k(e,a):m(e,a)}})});r[e]=q(e,u,v,g.writeback&&!d.Una);
return!0}return!1}function k(a,b){f.ignoreDependencies(function(){m(a,f.utils.unwrapObservable(b))});return b.subscribe(function(b){J[a]||m(a,b)})}function q(d,e,g,h){function k(a){var q=!1;P||(h&&f.ignoreDependencies(function(){var d=a.detail.value,h=g(c);f.isWriteableObservable(h)?(q=!0,h(d)):(h=b.Sr.l3(e),null!=h&&(b.ia.uA(h)(c)(d),q=!0))}),q||(J[d]=!0))}a.addEventListener(d+Q,k);return k}function l(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}function m(b,c){P=!0;try{a[b]=
c}finally{P=!1}}this.Rj=function(b){var c=b.properties;if(c){s.setAttribute=a.setAttribute;s.removeAttribute=a.removeAttribute;a.setAttribute=function(a,b){e(a,b,s.setAttribute)};a.removeAttribute=function(a){e(a,null,s.removeAttribute)};var e=function(b,e,f){b=b.toLowerCase();var h=a.getAttribute(b);f.apply(a,arguments);var k=a.getAttribute(b),q=g(b);a.hasOwnProperty(q)&&k!==h&&d(c[q],q,k)};b=Object.keys(c);C=!0;try{b.forEach(function(b){var e=l(b),f=c[b];a.hasAttribute(e)?(e=a.getAttribute(e),d(f,
b,e)):f.readOnly||(a[b]=f.value)})}finally{C=!1}}return this};this.lpa=function(){return C};this.Bqa=function(a){var b;[p,n].forEach(function(a){b=Object.keys(a);for(a=0;a<b.length;a++)n[b[a]].dispose()});p={};n={};b=Object.keys(s);var c;for(c=0;c<b.length;c++){var d=b[c];a[d]=s[d]}s={};b=Object.keys(r);for(c=0;c<b.length;c++)d=b[c],a.removeEventListener(d+Q,r[d]);r={}};var n={},p={},r={},s={},J={},C,P,Q="-changed"}(function(){b.OS.F1({nodeHasBindings:function(a,c){return c||1===a.nodeType&&b.we.WG(a.nodeName.toLowerCase())},
getBindingAccessors:function(a,c,d){if(1===a.nodeType&&(a=a.nodeName.toLowerCase(),b.we.WG(a))){d=d||{};if(d.ojComposite)throw"Cannot use ojComposite binding on a custom element whose name is already registered for a composite binding";var e={name:a};d.ojComposite=function(){return e}}return d},preprocessNode:function(a,c){var d;if(1===a.nodeType&&"oj-slot"===a.nodeName.toLowerCase()){d=["name","slot","index"];for(var e="ko _ojSlot_:{",f=[],g=0;g<d.length;g++){var h=d[g],k;k=a.getAttribute(h);if(null!=
k){var q=b.Sr.Z2(k).expr;null==q&&(q="'"+k+"'");k=q}else k=null;k&&f.push(h+":"+k)}e+=f.join(",");g=document.createComment(e+"}");e=document.createComment("/ko");d=[g];f=a.parentNode;for(f.insertBefore(g,a);0<a.childNodes.length;)g=a.childNodes[0],f.insertBefore(g,a),d.push(g);d.push(e);f.replaceChild(e,a)}return d?d:c}})})();b.we={};b.we.Gb={viewPath:"text!composite/views/",viewSuffix:".html",modelPath:"composite/viewModels/",metadataPath:"text!composite/metadata/",metadataSuffix:".json",cssPath:"css!composite/css/",
initializeMethod:"initialize",activatedMethod:"activated",attachedMethod:"attached",bindingsAppliedMethod:"bindingsApplied",disposeMethod:"dispose"};o_("Composite.defaults",b.we.Gb,b);b.we.register=function(a,c){b.we.h_[a]=c};o_("Composite.register",b.we.register,b);b.we.WG=function(a){return b.we.h_[a]};b.we.h_={};f.bindingHandlers.ojComposite={init:function(){return{controlsDescendantBindings:!0}},update:function(a,h,k,l,u){function y(b){G&&(G.Bqa(a),G=null);A=b;c(F,"disposeMethod",[a]);F=null;
z&&m(a,z);J&&(a.removeChild(J),J=null);z=null;E={}}function B(a){return function(b){if(A||b!=D)throw L;return a.apply(this,Array.prototype.slice.call(arguments,1))}.bind(null,D)}var L=Error(),F,G,D=-1,A=!1,z,E={},J,C=f.utils.unwrapObservable;f.ignoreDependencies(function(){f.computed(function(){D++;a.dispatchEvent(new CustomEvent("pending",{bubbles:!0}));y(!1);var k=C(h())||{},k=C(k.name),l=b.we.WG(k);if(!l)throw"Composite is missing a descriptor";var m=d(l,"metadata"),k=null;m&&(k=m.then(B(function(c){c?
(z=c,G=new r(a,u),e(a,E,c,G),G.Rj(c)):b.r.Hsa("ojComposite is being loaded without metadata. No element properties will be set up");return E})));var x,m=new Promise(function(a){x=a}),v=q+s++,N={element:a,props:k,slotNodeCounts:m,unique:v},m=null,O=d(l,"viewModel");O&&(m=O.then(B(function(a){return a="function"===typeof a?new a(N):c(a,"initializeMethod",[N])||a})));O=null;m&&(O=m.then(B(function(a){return c(a,"activatedMethod",[N])})));var T=d(l,"view");T&&(T=T.then(B(function(a){if("string"===typeof a)a=
f.utils.parseHtmlFragment(a);else if(window.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType)a=f.utils.arrayPushAll([],a.childNodes);else if(Array.isArray(a))a=f.utils.arrayPushAll([],a);else throw"The View ("+a+") has an unsupported type";return a})));(l=d(l,"css"))&&(l=l.then(B(function(a){if(a){var b=document.createElement("style");b.type="text/css";b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a));document.head.appendChild(b)}})));f.applyBindingsToDescendants(u,
a);Promise.all([T,m,k,l,O]).then(function(b,d){if(!A&&b==D){var e=d[0];if(!e)throw"ojComposite is missing a View";var h=n(a),k={},q;for(q in h)k[q]=h[q].length;x(k);J=p(a,e);f.virtualElements.setDomNodeChildren(a,e);F=d[1];c(F,"attachedMethod",[N]);e=u.createChildContext(F,void 0,function(a){a.__oj_slots=h;a.__oj_nodestorage=J;a.$slotNodeCounts=k;a.$props=E;a.$unique=v});z&&F&&g(a,z,F);f.applyBindingsToDescendants(e,a);c(F,"bindingsAppliedMethod",[N]);a.dispatchEvent(new CustomEvent("ready",{bubbles:!0}))}}.bind(null,
D),function(a,c){c!==L&&null!=c&&b.r.error(c)}.bind(null,D))},null,{disposeWhenNodeIsRemoved:a})});f.utils.domNodeDisposal.addDisposeCallback(a,y.bind(null,!0,u))}};var s=0,q="_ojcomposite";f.bindingHandlers._ojNodeStorage_={init:function(){return{controlsDescendantBindings:!0}}};f.bindingHandlers._ojSlot_={init:function(a,b,c,d,e){f.utils.domNodeDisposal.addDisposeCallback(a,function(b){if(b=b.__oj_nodestorage)for(var c;c=f.virtualElements.firstChild(a);)null!=c.__oj_slots&&b.appendChild(c)}.bind(null,
e));d=e.__oj_slots;b=b();c=f.utils.unwrapObservable;e=c(b.name)||"";var g=c(b.index);if(d=null!=g?[d[e][g]]:d[e]){for(e=0;e<d.length;e++)d[e].__oj_slots=c(b.slot)||"";f.virtualElements.setDomNodeChildren(a,d);return{controlsDescendantBindings:!0}}}};f.virtualElements.allowedBindings._ojSlot_=!0});